---
title: "Proyecto Final-Temperaturas"
author: "Luraghi-Rodriguez"
date: "June 18, 2018"
output: pdf_document
bibliography: biblio.bib
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy.opts = list(width.cutoff = 50), tidy = TRUE, fig.pos = 'h', out.extra = '')

```

###BORRADOR

## INTRODUCCION

OBJETIVO:

Relaizar un análisis exploratorio de los datos utilizados para un proyecto cuyo objetivo general es la modelización y predicción de las temperaturas mínimas extremas en Uruguay, utilizando el enfoque
de la teoría de valores extremos.

La modelización de los eventos extremos climáticos resulta de particular interés en la actualidad, debido
al gran impacto que estos fenómenos producen tanto en la población como en los sectores productivos.
Estos últimos, que resultan especialmente sensibles a la variabilidad climática, adolecen en general de
un conocimiento confiable sobre la ocurrencia de sucesos extremos y les es imprescindible asignarles
ciertas probabilidades de ocurrencia. 

Uno de los objetivos específicos del proyecto sobre valores extremos consiste en comparar dos metodologías para la modelización, obteniendo predicciones de los niveles de retorno mediante el Método de Valores Extremos
por Bloques y el Método del Umbral. Además, se busca contrastar los resultados obtenidos mediante el
uso de los diversos paquetes del software estadístico R actualmente disponibles, por lo tanto realizaremos también la exploración de las bases de datos de valores extremos utilizadas para cada uno de los dos métodos mencionados.



## DATOS
La base de datos original está compuesta por registros diarios de temperaturas mínimas
de 26 estaciones meteorológicas de Uruguay para el período 2002-2014. Los datos están comprendidos
entre el 1o de enero de 2002 y el 31 de diciembre de 2014, lo cual implica un total de 4.526
observaciones por estación (118664 observaciones en total). 

La base incluye las siguientes variables:


* nroEstacion: Número de Estación
* lon: Longitud en la cual se encuentra ubicada la Estación
* lat: Latitud en la cual se encuentra ubicada la Estación
* altitud: Altura de la estación respecto al nivel del mar 
* anio: Año en el cual se registró la temperatura
* mes: Mes en el cual se registró la temperatura
* dia: Día en el cual se registró la temperatura
* tmin: valor en grados celsius de la temperatura mínima del día.
* modis1: Temperatura registrada por satélite
* modis2: Temperatura registrada por satélite 

Sin embargo para la realización del proyecto las variables a utilizar son: 

* Número de estación
* Fecha: para tener un orden cronológico, creamos esta nueva variable a partir de las variables año, mes y día
* Temperatura mínima registrada 
* Coordenadas geograficas para un análisis espacial.
* Departamento: asignada de acuerdo a la ubicación geográfica (latitud, longitud) de cada estación.
* Creamos una variable con el nombre de cada estación.
* Zona: creamos una variable categórica la cual clasifica a los departamentos en Centro, Norte o Sur. 



##ANALISIS EXPLORATORIO DE DATOS

En este apartado se presentan los resultados del análisis exploratorio realizado para comprender los datos a efectos de poder aplicar teoría de extremos.

El primer punto a tener en cuenta es la existencia de estacionalidad. Sabemos que la temperatura tiene un comportamiento estacional, es decir todos los años la temperatura se comporta de la misma manera (temperaturas altas en verano, bajas en invierno). Lo corroboramos con el siguiente gráfico:


```{r, warning=FALSE, echo=FALSE,message=FALSE}
library(ggplot2)
library(ggvis)
library(tidyverse)
library(lubridate)
library(raster)
library(rgeos)
library(rgdal)
library(tseries)
library(xtable)
library(forecast)
library(dplyr)
```




```{r,echo=FALSE}
cap1 <- "
Graficamos los registros de temperatura de las 26 estaciones.Como es esperado, se observa una gran presencia de estacionalidad. Claramente en cada invierno las temperaturas mínimas son las más bajas, en verano las más altas y en primavera y otoño nos ubicamos en la franja media."
```


```{r , warning=FALSE, echo=FALSE,fig.cap=cap1,warning=FALSE, message=FALSE}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha = paste(dia, mes, 
  anio, sep = "-"))
temperaturas <- mutate(temperaturas, fecha = dmy(temperaturas$fecha))

temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion))

serie <- temperaturas  %>% ggplot(aes(fecha,tmin))+geom_point(alpha=0.05)+labs(x="Fecha", y="Temperatura mínima diaria")
serie

```



\newpage


De acuerdo a la Figura \@ref(Figure 1), parecería que la media es constante. Calculemos la media de las temperaturas mínimas para cada año:




```{r,results='asis',echo=FALSE}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha = paste(dia, mes, 
  anio, sep = "-"))

options(xtable.comment = FALSE)

mutate(temperaturas, fecha = dmy(temperaturas$fecha)) %>% group_by(Año=anio) %>% summarise(Media=mean(tmin,na.rm = TRUE)) %>% xtable()


```
Como se puede observar en la tabla, la temperatura mínima media año a año no sufre mucha variación, por lo que podríamos afirmar que es constante


Analizaremos como es el comportamiento de la temperatura dentro del año para una estación en particular. Elegimos la estación número 2, la cual corresponde a la estación de Melilla, Canelones.


```{r, echo=FALSE}
cap3 <- "Comportamiento de las temparaturas mínimas para la estación Melilla, Canelones en el período 2004-2014"
```




```{r, echo=FALSE, fig.cap=cap3}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste("01",mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion))


temperaturas <-filter(temperaturas,Estacion==2) %>% group_by(anio,mes) %>%  slice(which.min(tmin)) %>% filter(anio>2003)

temperaturas_ts <- ts(temperaturas$tmin, start=c(2004, 1), end=c(2014, 12), frequency=12)


ggseasonplot(temperaturas_ts, season.labels = c("Ene","Feb", "Mar","Abr","May","Jun","Jul","Ago","Set","Oct","Nov","Dic")) + xlab("Mes") + ylab("temperatura mínima")+labs(title="")


```

De acuerdo al gráfico 3 no se observan indicios de existencia de una tendencia, es decir que al pasar de los años haya un corrimiento de las funciones (calentamiento o enfriamiento global)


\newpage

#Análisis de Outliers

Nuestro interés son las temperaturas extremas, por lo cual veremos si tenemos valores atípicos entre los meses de mayo y setiembre.



```{r, echo=FALSE}
cap4 <- "Boxplot de temperaturas mínimas para cada estación"
```



```{r,warning=FALSE,echo=FALSE, fig.cap=cap4}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))


temperaturas <- mutate(temperaturas,Nombre = ifelse(nroEstacion %in% 
  c(1), "Carrasco,Canelones", ifelse(nroEstacion %in% c(2), 
  "Melilla,Canelones", ifelse(nroEstacion %in% c(3), "Artigas, Artigas", 
    ifelse(nroEstacion %in% c(4), "Coronado,Artigas", ifelse(nroEstacion %in% 
      c(5), "Laguna de los Patos, Colonia", ifelse(nroEstacion %in% c(6), "Santa Bernardina,Durazno", 
      ifelse(nroEstacion %in% c(7), "Florida,Florida", ifelse(nroEstacion %in% 
        c(8), "Laguna del Sauce,Maldonado", ifelse(nroEstacion %in% c(9), 
        "Melo, Cerro Largo", ifelse(nroEstacion %in% c(10), 
          "Mercedes,Soriano", ifelse(nroEstacion %in% c(11), 
          "Paso de los Toros, Tacuarembó", ifelse(nroEstacion %in% c(12), "Chacras de Paysandú, Paysandú", ifelse(nroEstacion %in%  c(13), "Prado,Montevideo", ifelse(nroEstacion %in% 
            c(14), "Punta del Este, Maldonado", ifelse(nroEstacion %in% 
            c(15), "Rivera,Rivera", ifelse(nroEstacion %in% 
            c(16), "Ciudad de Rocha,Rocha", ifelse(nroEstacion %in% 
            c(17), "Nueva Hesperides,Salto", ifelse(nroEstacion %in% 
            c(18), "San José, San José", ifelse(nroEstacion %in% 
            c(19), "Ciudad de Tacuarembó, Tacuarembó", ifelse(nroEstacion %in% 
            c(20), "Nueva Hesperides,Salto",ifelse(nroEstacion %in% 
            c(21), "Trinidad,Flores", ifelse(nroEstacion %in% 
            c(22), "Young,Río Negro", ifelse(nroEstacion %in% 
            c(23), "Lascano,Rocha", ifelse(nroEstacion %in% 
            c(24), "El Semillero,Colonia", ifelse(nroEstacion %in% 
            c(25), "Las Brujas,Canelones", "El Naranjal,Salto"))))))))))))))))))))))))))


temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion)) %>% filter(mes %in% c(5,6,7,8,9) )

ggplot(temperaturas,aes(Nombre,tmin))+geom_boxplot()+labs(x="Estación", y="temperatura mínima")+theme(axis.text.x = element_text(angle = 90, size = 8))


```
De la Figura 4 surge que tenemos outliers en varias estaciones, pero como lo que nos interesa es estudiar las temperaturas mínimas extremas sólo miraremos a las estaciones que presentan outliers en los mínimos, es decir las estaciones Floria, Prado y Punta del Este.

Outlier de la estación Florida:




```{r,warning=FALSE, echo=FALSE,results='asis'}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

estac <-filter(temperaturas,nroEstacion %in% c(7)) %>% filter(mes %in% c(5,6,7,8,9)) %>% filter(!is.na(tmin)) 
df2 <- subset(estac, select = c(nroEstacion,tmin,fecha))
df2 <- mutate(df2,fecha=as.character(fecha))
options(xtable.comment = FALSE)

group_by(df2,nroEstacion) %>% top_n(-1,tmin) %>% xtable() 


```

La comparamos con la estación Durazno que se encuentre geográficamente cerca


```{r,echo=FALSE,results='asis'}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))


temperaturas <- mutate(temperaturas,Nombre = ifelse(nroEstacion %in% 
  c(1), "Carrasco,Canelones", ifelse(nroEstacion %in% c(2), 
  "Melilla,Canelones", ifelse(nroEstacion %in% c(3), "Artigas, Artigas", 
    ifelse(nroEstacion %in% c(4), "Coronado,Artigas", ifelse(nroEstacion %in% 
      c(5), "Laguna de los Patos, Colonia", ifelse(nroEstacion %in% c(6), "Santa Bernardina,Durazno", 
      ifelse(nroEstacion %in% c(7), "Florida,Florida", ifelse(nroEstacion %in% 
        c(8), "Laguna del Sauce,Maldonado", ifelse(nroEstacion %in% c(9), 
        "Melo, Cerro Largo", ifelse(nroEstacion %in% c(10), 
          "Mercedes,Soriano", ifelse(nroEstacion %in% c(11), 
          "Paso de los Toros, Tacuarembó", ifelse(nroEstacion %in% c(12), "Chacras de Paysandú, Paysandú", ifelse(nroEstacion %in%  c(13), "Prado,Montevideo", ifelse(nroEstacion %in% 
            c(14), "Punta del Este, Maldonado", ifelse(nroEstacion %in% 
            c(15), "Rivera,Rivera", ifelse(nroEstacion %in% 
            c(16), "Ciudad de Rocha,Rocha", ifelse(nroEstacion %in% 
            c(17), "Nueva Hesperides,Salto", ifelse(nroEstacion %in% 
            c(18), "San José, San José", ifelse(nroEstacion %in% 
            c(19), "Ciudad de Tacuarembó, Tacuarembó", ifelse(nroEstacion %in% 
            c(20), "Nueva Hesperides,Salto",ifelse(nroEstacion %in% 
            c(21), "Trinidad,Flores", ifelse(nroEstacion %in% 
            c(22), "Young,Río Negro", ifelse(nroEstacion %in% 
            c(23), "Lascano,Rocha", ifelse(nroEstacion %in% 
            c(24), "El Semillero,Colonia", ifelse(nroEstacion %in% 
            c(25), "Las Brujas,Canelones", "El Naranjal,Salto"))))))))))))))))))))))))))


 f <- filter(temperaturas,nroEstacion==6
             ) %>% filter(fecha =="2012-07-28")
options(xtable.comment = FALSE)
f <- mutate(f,fecha=as.character(fecha))
subset(f, select = c(nroEstacion,tmin,fecha,Nombre)) %>% xtable()


```



Outlier para la estación Prado:


```{r,warning=FALSE, echo=FALSE,results='asis'}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

estac <-filter(temperaturas,nroEstacion %in% c(13)) %>% filter(mes %in% c(5,6,7,8,9)) %>% filter(!is.na(tmin)) 
df2 <- subset(estac, select = c(nroEstacion,tmin,fecha))
df2 <- mutate(df2,fecha=as.character(fecha))
options(xtable.comment = FALSE)

group_by(df2,nroEstacion) %>% top_n(-1,tmin) %>% xtable() 


```

Lo comparamos con la estación Melilla de Canelones


```{r,echo=FALSE,results='asis'}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))


temperaturas <- mutate(temperaturas,Nombre = ifelse(nroEstacion %in% 
  c(1), "Carrasco,Canelones", ifelse(nroEstacion %in% c(2), 
  "Melilla,Canelones", ifelse(nroEstacion %in% c(3), "Artigas, Artigas", 
    ifelse(nroEstacion %in% c(4), "Coronado,Artigas", ifelse(nroEstacion %in% 
      c(5), "Laguna de los Patos, Colonia", ifelse(nroEstacion %in% c(6), "Santa Bernardina,Durazno", 
      ifelse(nroEstacion %in% c(7), "Florida,Florida", ifelse(nroEstacion %in% 
        c(8), "Laguna del Sauce,Maldonado", ifelse(nroEstacion %in% c(9), 
        "Melo, Cerro Largo", ifelse(nroEstacion %in% c(10), 
          "Mercedes,Soriano", ifelse(nroEstacion %in% c(11), 
          "Paso de los Toros, Tacuarembó", ifelse(nroEstacion %in% c(12), "Chacras de Paysandú, Paysandú", ifelse(nroEstacion %in%  c(13), "Prado,Montevideo", ifelse(nroEstacion %in% 
            c(14), "Punta del Este, Maldonado", ifelse(nroEstacion %in% 
            c(15), "Rivera,Rivera", ifelse(nroEstacion %in% 
            c(16), "Ciudad de Rocha,Rocha", ifelse(nroEstacion %in% 
            c(17), "Nueva Hesperides,Salto", ifelse(nroEstacion %in% 
            c(18), "San José, San José", ifelse(nroEstacion %in% 
            c(19), "Ciudad de Tacuarembó, Tacuarembó", ifelse(nroEstacion %in% 
            c(20), "Nueva Hesperides,Salto",ifelse(nroEstacion %in% 
            c(21), "Trinidad,Flores", ifelse(nroEstacion %in% 
            c(22), "Young,Río Negro", ifelse(nroEstacion %in% 
            c(23), "Lascano,Rocha", ifelse(nroEstacion %in% 
            c(24), "El Semillero,Colonia", ifelse(nroEstacion %in% 
            c(25), "Las Brujas,Canelones", "El Naranjal,Salto"))))))))))))))))))))))))))


 f <- filter(temperaturas,nroEstacion==2
             ) %>% filter(fecha =="2009-07-31")
options(xtable.comment = FALSE)
f <- mutate(f,fecha=as.character(fecha))
subset(f, select = c(nroEstacion,tmin,fecha,Nombre)) %>% xtable()


```




Outliers de la estacion Punta del Este

```{r,warning=FALSE, echo=FALSE,results='asis'}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

estac <-filter(temperaturas,nroEstacion %in% c(14)) %>% filter(mes %in% c(5,6,7,8,9)) %>% filter(!is.na(tmin)) 
df2 <- subset(estac, select = c(nroEstacion,tmin,fecha))
df2 <- mutate(df2,fecha=as.character(fecha))
options(xtable.comment = FALSE)

group_by(df2,nroEstacion) %>% top_n(-2,tmin) %>% xtable() 


```

Comparamos con la otra estación Laguna del Sauce,Maldonado



```{r,echo=FALSE,results='asis'}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))


temperaturas <- mutate(temperaturas,Nombre = ifelse(nroEstacion %in% 
  c(1), "Carrasco,Canelones", ifelse(nroEstacion %in% c(2), 
  "Melilla,Canelones", ifelse(nroEstacion %in% c(3), "Artigas, Artigas", 
    ifelse(nroEstacion %in% c(4), "Coronado,Artigas", ifelse(nroEstacion %in% 
      c(5), "Laguna de los Patos, Colonia", ifelse(nroEstacion %in% c(6), "Santa Bernardina,Durazno", 
      ifelse(nroEstacion %in% c(7), "Florida,Florida", ifelse(nroEstacion %in% 
        c(8), "Laguna del Sauce,Maldonado", ifelse(nroEstacion %in% c(9), 
        "Melo, Cerro Largo", ifelse(nroEstacion %in% c(10), 
          "Mercedes,Soriano", ifelse(nroEstacion %in% c(11), 
          "Paso de los Toros, Tacuarembó", ifelse(nroEstacion %in% c(12), "Chacras de Paysandú, Paysandú", ifelse(nroEstacion %in%  c(13), "Prado,Montevideo", ifelse(nroEstacion %in% 
            c(14), "Punta del Este, Maldonado", ifelse(nroEstacion %in% 
            c(15), "Rivera,Rivera", ifelse(nroEstacion %in% 
            c(16), "Ciudad de Rocha,Rocha", ifelse(nroEstacion %in% 
            c(17), "Nueva Hesperides,Salto", ifelse(nroEstacion %in% 
            c(18), "San José, San José", ifelse(nroEstacion %in% 
            c(19), "Ciudad de Tacuarembó, Tacuarembó", ifelse(nroEstacion %in% 
            c(20), "Nueva Hesperides,Salto",ifelse(nroEstacion %in% 
            c(21), "Trinidad,Flores", ifelse(nroEstacion %in% 
            c(22), "Young,Río Negro", ifelse(nroEstacion %in% 
            c(23), "Lascano,Rocha", ifelse(nroEstacion %in% 
            c(24), "El Semillero,Colonia", ifelse(nroEstacion %in% 
            c(25), "Las Brujas,Canelones", "El Naranjal,Salto"))))))))))))))))))))))))))


 f <- filter(temperaturas,nroEstacion==16
             ) %>% filter(fecha =="2013-07-22"|fecha=="2013-08-23")
options(xtable.comment = FALSE)
f <- mutate(f,fecha=as.character(fecha))
subset(f, select = c(nroEstacion,tmin,fecha,Nombre)) %>% xtable()


```


Queremos ver si hay algún año en particular en el que se cumpla que todas las estaciones registraron su mínimo del periodo:






```{r,echo=FALSE,results='asis'}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))


temperaturas <- mutate(temperaturas,Nombre = ifelse(nroEstacion %in% 
  c(1), "Carrasco,Canelones", ifelse(nroEstacion %in% c(2), 
  "Melilla,Canelones", ifelse(nroEstacion %in% c(3), "Artigas, Artigas", 
    ifelse(nroEstacion %in% c(4), "Coronado,Artigas", ifelse(nroEstacion %in% 
      c(5), "Laguna de los Patos, Colonia", ifelse(nroEstacion %in% c(6), "Santa Bernardina,Durazno", 
      ifelse(nroEstacion %in% c(7), "Florida,Florida", ifelse(nroEstacion %in% 
        c(8), "Laguna del Sauce,Maldonado", ifelse(nroEstacion %in% c(9), 
        "Melo, Cerro Largo", ifelse(nroEstacion %in% c(10), 
          "Mercedes,Soriano", ifelse(nroEstacion %in% c(11), 
          "Paso de los Toros, Tacuarembó", ifelse(nroEstacion %in% c(12), "Chacras de Paysandú, Paysandú", ifelse(nroEstacion %in%  c(13), "Prado,Montevideo", ifelse(nroEstacion %in% 
            c(14), "Punta del Este, Maldonado", ifelse(nroEstacion %in% 
            c(15), "Rivera,Rivera", ifelse(nroEstacion %in% 
            c(16), "Ciudad de Rocha,Rocha", ifelse(nroEstacion %in% 
            c(17), "Nueva Hesperides,Salto", ifelse(nroEstacion %in% 
            c(18), "San José, San José", ifelse(nroEstacion %in% 
            c(19), "Ciudad de Tacuarembó, Tacuarembó", ifelse(nroEstacion %in% 
            c(20), "Nueva Hesperides,Salto",ifelse(nroEstacion %in% 
            c(21), "Trinidad,Flores", ifelse(nroEstacion %in% 
            c(22), "Young,Río Negro", ifelse(nroEstacion %in% 
            c(23), "Lascano,Rocha", ifelse(nroEstacion %in% 
            c(24), "El Semillero,Colonia", ifelse(nroEstacion %in% 
            c(25), "Las Brujas,Canelones", "El Naranjal,Salto"))))))))))))))))))))))))))

temperaturas <- mutate(temperaturas,Zona = ifelse(nroEstacion %in% 
  c(5,24,18,25,2,1,13,8,16,7), "SUR", ifelse(nroEstacion %in% c(11,10,21,22,6,20,23), 
  "CENTRO","NORTE")))


a <- group_by(temperaturas,nroEstacion) %>% slice(which.min(tmin)) %>% arrange(desc(tmin))
options(xtable.comment = FALSE)
a <- mutate(a, fecha=as.character(fecha))
subset(a,select=c(Nombre,tmin,fecha,nroEstacion))%>% xtable() 

```

constatamos que los años mas fríos fueron 2012 y 2007.


¿Hay alguna relación entre la zona y los mínimos registrados?



```{r, echo=FALSE}
cap5 <- "Se observalas temperaturas mínimas registradas por año en cada zona. En la mayoria de los años la tempreatura mínima del Sur son más altasque el Norte Y el Centro
"

```


```{r,echo=FALSE,results='asis', fig.cap=cap5}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))


temperaturas <- mutate(temperaturas,Nombre = ifelse(nroEstacion %in% 
  c(1), "Carrasco,Canelones", ifelse(nroEstacion %in% c(2), 
  "Melilla,Canelones", ifelse(nroEstacion %in% c(3), "Artigas, Artigas", 
    ifelse(nroEstacion %in% c(4), "Coronado,Artigas", ifelse(nroEstacion %in% 
      c(5), "Laguna de los Patos, Colonia", ifelse(nroEstacion %in% c(6), "Santa Bernardina,Durazno", 
      ifelse(nroEstacion %in% c(7), "Florida,Florida", ifelse(nroEstacion %in% 
        c(8), "Laguna del Sauce,Maldonado", ifelse(nroEstacion %in% c(9), 
        "Melo, Cerro Largo", ifelse(nroEstacion %in% c(10), 
          "Mercedes,Soriano", ifelse(nroEstacion %in% c(11), 
          "Paso de los Toros, Tacuarembó", ifelse(nroEstacion %in% c(12), "Chacras de Paysandú, Paysandú", ifelse(nroEstacion %in%  c(13), "Prado,Montevideo", ifelse(nroEstacion %in% 
            c(14), "Punta del Este, Maldonado", ifelse(nroEstacion %in% 
            c(15), "Rivera,Rivera", ifelse(nroEstacion %in% 
            c(16), "Ciudad de Rocha,Rocha", ifelse(nroEstacion %in% 
            c(17), "Nueva Hesperides,Salto", ifelse(nroEstacion %in% 
            c(18), "San José, San José", ifelse(nroEstacion %in% 
            c(19), "Ciudad de Tacuarembó, Tacuarembó", ifelse(nroEstacion %in% 
            c(20), "Nueva Hesperides,Salto",ifelse(nroEstacion %in% 
            c(21), "Trinidad,Flores", ifelse(nroEstacion %in% 
            c(22), "Young,Río Negro", ifelse(nroEstacion %in% 
            c(23), "Lascano,Rocha", ifelse(nroEstacion %in% 
            c(24), "El Semillero,Colonia", ifelse(nroEstacion %in% 
            c(25), "Las Brujas,Canelones", "El Naranjal,Salto"))))))))))))))))))))))))))

temperaturas <- mutate(temperaturas,Zona = ifelse(nroEstacion %in% 
  c(5,24,18,25,2,1,13,8,16,7), "SUR", ifelse(nroEstacion %in% c(11,10,21,22,6,20,23), 
  "CENTRO","NORTE")))


a <- group_by(temperaturas,anio,Zona) %>% slice(which.min(tmin))
  options(xtable.comment = FALSE)
subset(a,select=c(anio,Zona,tmin))%>% xtable() 

ggplot(a, aes(anio,tmin, colour=Zona))+geom_line()+labs(x="Año", y="Temperatura", title="Temperaturas mínimas por año y Zona")

```




hay correlacion entre las temperaturas mínimas y la altitud?


Plot de temperatura mínima registrada en cada año, (puede ser un plotly) coloreado por zona de estación. La idea es explorar si los mínimos siempre se dan en la misma zona o no. si hay una correlación.


Exploración espacial:

Se presentan dos mapas, uno en el cual se ubican las estaciones seleccionadas y otro que muestra las temperaturas mínimas por mes en cada departamento coloreado por las temperaturas.



#Metodologia.

El interés de la Teoría de valores extremos está centrado en modelar el comportamiento de $M_n = max \{X_1,X_2, \ldots, X_n \} $ siendo $X_1,X_2, \ldots , X_n$ una secuencia de variables aleatorias independientes con distribución F, y M_n representa el maximo del proceso sobre n unidades de tiempos de observación. 

En Teoría la distribución de $M_n$ podría calcularse de manera exacta a partir de la función de distribución F: 

$P(M_n \leq z) = P(X_1 \leq z, \ldots , X_n \leq z = P(X_1 \leq z) \times \ldots \times P(X_n \leq z) = [F(z)]^n$
            
Sin embargo, al sustituir F (desconocida) por su estimación y elevar a la n, pueden generarse grandes discrepancias.

Un camino alternativo a este problema, es considerar F desconocida y aproximar directamente la distribución de $F^n$ utilizando un subconjunto de la base, los valores extremos. 

Esta solución, análoga al Teorema Central del Límite, consiste en la busqueda de secuencias constantes $\{b_n; n \geq 1 \}$ y $\{a_n; n \geq 1 \}$ tales que la distribución de $M_n^* = \frac{M_n - b_n}{a_n}$ converge a una distribución no degenerada cuando $n \to + \inf$ .

## Teorema de Valores extremos: 

Si existen sucesiones constantes $a_n > 0$ y $b_n$ tales que: 

$P(M^*_n = \cfrac{M_n - b_n}{a_n} \leq z) = F^n(a_nz + b_n)\to G(z)$ 

entonces G pertenece a una de las siguientes familias: 

#################################################

El Teorema (1.1) afirma que $M^*_n$ converge en distribución a una de las tres familias de distribuciones mencionadas en el teorema las que, en conjunto, se denominan distribuciones de valores extremos (DVE). En particular, $(a)$ es la distribución de Gumbel, $(b)$ es la distribución de Fréchet y $(c)$ es la distribución de Weibull. Cada familia tiene un parámetro de ubicación y escala, $\mu$ y $\sigma$ respectivamente, y un parámetro de forma $\alpha$ en el caso de las familias Fréchet y Weibull. 

Si bien el Teorema (1.1) no garantiza la existencia de un límite no degenerado para $M_n$, ni nos dice cuál es el límite cuando existe, la distribución límite de la variable normalizada $M^*_n$ tiene que ser alguna de las distribuciones incluidas en el teorema, cualquiera sea la distribución poblacional $F$.
\\

Los tres tipos de distribución del teorema pueden ser combinados en una sola distribución con una parametrización común, propuesta por Von Mises (1954) y Jenkinson (1955), que se conoce como la \textbf{Distribución de Valores Extremos Generalizada} (GEV, por sus siglas en inglés). La forma de esta distribución es: 


$G_{\xi,\mu,\sigma}(x) = exp\ \Big\{-\Big(1+\xi \Big(\cfrac{x-\mu}{\sigma}\Big)\Big)_+^{-1/ \xi}\Big\}$





En los siguientes métodos asumiremos que la función F (distribución de los daots) es desconocida, y estimaremos directamente la distribución extrema, para esto intentamos captar en una nueva base aquellos valores extremos sobre los cuales nos interesa trabajar.


Método del umbral: Consiste en seleccionar un valor u llamado umbral, y considerar aquellas observaciones que superen este valor. La elección de un umbral muy bajo aumentará el sesgo del modelo, mientras que la eleccion de un umbral demasiado alto aumentará la varianza.

Método "Block Maxima": Útil cuando los datos pueden ser divididos en m bloques de tamaño m, el método consiste en seleccionar la temperatura extrema por bloque, asumiendo que las observaciones de los máximos por bloque son independientes.
La elección del tamaño del bloque genera un trade-off entre sesgo y varianza, tomar bloques pequeños generan un mayor sesgo mientras que bloques de mayor tamaño aumentan la varianza en la estimacion de los parametros de la distribución.


---
nocite: | 
  @citaR, @leaf
...





##Descripción de la aplicación shiny

A través de la aplicación Shiny, mostraremos el análisis exploratorio interactivo.

Se estructura en 4 pesatañas:

Base de datos: En esta pesataña el usuario puede realizar múltiples filtraciones, (explicar)

Visualización: Aqui introducimos la exploración espacial, donde se pueden seleccionar las estaciones y a través del paquete Leaflet de R , se despliega un mapa marcando geograficamente el punto donde se encuentra la estación.
Por otro lado se ve también un mapa de la serie de temperaturas para las estaciones seleccionadas anteriomente, con la opción de poder elegir el periodo.
En esta pesataña encontraremos un mapa del territorio uruguayo, el cual se encuentra coloreado por la temperatura mínima regsitrada en el mes para cada departamento. La escala de colores utilizada  ayuda a visualizar que departamentos registran temperaturas por encima de la media (rojos) y por debajo (azules) y con color blanco los que están sobre la media.




, aparecerán gráficos de la serie de temperaturas, pudiendo filtrar por numero de estación, y pudiendo ubicar geograficamente las mismas. Para todo el territorio uruguayo se podrá observar por mes las temperaturas mínimas registradas en cada departamento.









##Comentarios finales




## Referencias




