---
title: "Proyecto Final-Temperaturas"
author: "Luraghi-Rodriguez"
date: "June 18, 2018"
output: pdf_document
---

###BORRADOR

## INTRODUCCION

OBJETIVO:

Relaizar un análisis exploratorio de los datos utilizados para un proyecto cuyo objetivo general es la modelización y predicción de las temperaturas mínimas extremas en Uruguay, utilizando el enfoque
de la teoría de valores extremos.

La modelización de los eventos extremos climáticos resulta de particular interés en la actualidad, debido
al gran impacto que estos fenómenos producen tanto en la población como en los sectores productivos.
Estos últimos, que resultan especialmente sensibles a la variabilidad climática, adolecen en general de
un conocimiento confiable sobre la ocurrencia de sucesos extremos y les es imprescindible asignarles
ciertas probabilidades de ocurrencia. 

Uno de los objetivos específicos del proyecto sobre valores extremos consiste en comparar dos metodologías para la modelización, obteniendo predicciones de los niveles de retorno mediante el Método de Valores Extremos
por Bloques y el Método del Umbral. Además, se busca contrastar los resultados obtenidos mediante el
uso de los diversos paquetes del software estadístico R actualmente disponibles, por lo tanto realizaremos también la exploración de las bases de datos de valores extremos utilizadas para cada uno de los dos métodos mencionados.



## DATOS
La base de datos original está compuesta por registros diarios de temperaturas mínimas
de 26 estaciones meteorológicas de Uruguay para el período 2002-2014. Los datos están comprendidos
entre el 1o de enero de 2002 y el 31 de diciembre de 2014, lo cual implica un total de 4.526
observaciones por estación (118664 observaciones en total). 

La base incluye las siguientes variables:


* nroEstacion: Número de Estación
* lon: longitud en la cual se encuentra ubicada la Estación
* lat: Latitud en la cual se encuentra ubicada la Estación
* altitud: altura de la estación respecto al nivel del mar 
* anio: Año en el cual se registró la temperatura
* mes: Mes en el cual se registró la temperatura
* dia: Día en el cual se registró la temperatura
* tmin: valor en grados celsius de la temperatura mínima del día.
* modis1: Temperatura registrada por satélite
* modis2: Temperatura registrada por satélite 

Sin embargo para la realización del proyecto las variables a utilizar son: 
* número de estacion
* fecha: para tener un orden cronológico, creamos esta nueva variable a partir de las variables año, mes y día
* temperatura mínima registrada 
* coordenadas geograficas para un análisis espacial.
* departamento: asignada de acuerdo a la ubicación geográfica (latitud, longitud) de cada estación.




##ANALISIS EXPLORATORIO DE DATOS


Para la aplicación de métodos de teroría de extremos los datos no pueden ser estacionales ni dependientes(), por lo cual en primera instancia se corrobora con un gráfico de la serie.



```{r, warning=FALSE, echo=FALSE,message=FALSE}
library(ggplot2)
library(ggvis)
library(tidyverse)
library(lubridate)
library(raster)
library(rgeos)
library(rgdal)
library(tseries)
library(xtable)
library(forecast)
```


```{r, warning=FALSE, echo=FALSE}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha = paste(dia, mes, 
  anio, sep = "-"))
temperaturas <- mutate(temperaturas, fecha = dmy(temperaturas$fecha))

temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion))

serie <- temperaturas  %>% ggplot(aes(fecha,tmin))+geom_point()
serie

```



Graficamos los registros de temperatura de las 26 estaciones para observar el comportamiento de los datos, como es esperado se observa una gran presencia de estacionalidad. Claramente en cada invierno se observa una caida en las temperaturas y en verano están los picos. Se observa una media constante.



observemos una estación en particular:


```{r, echo=FALSE}
temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste("01",mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion))


temperaturas <-filter(temperaturas,Estacion==2) %>% group_by(anio,mes) %>%  slice(which.min(tmin)) %>% filter(anio>2003)

temperaturas_ts <- ts(temperaturas$tmin, start=c(2004, 1), end=c(2014, 12), frequency=12)


ggseasonplot(temperaturas_ts, season.labels = c("Ene","Feb", "Mar","Abr","May","Jun","Jul","Ago","Set","Oct","Nov","Dic")) + labs(title="Temperaturas mínimas por año") + xlab("Mes") + ylab("temperatura mínima")


```

agregar como comentario de figura:

Podemos observar que para todos los años se da el mismo comportamiento, lo que confirma la existencia de estacionalidad, no se observa una tendencia, es decir que al pasar de los años haya un corrimiento de las funciones.

Más adelante veremos métodos que nos ayudan a elegir datos de manera que no exista esta estacionalidad.


Como el objetivo es modelar temperaturas extremas, y dentro de éstas los mínimos, nos enfocaremos en los meses de invierno.

veremos si tenemos outliers entre los meses de mayo y setiembre



```{r,warning=FALSE,echo=FALSE}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion)) %>% filter(mes %in% c(5,6,7,8,9) )

ggplot(temperaturas,aes(x=fct_reorder(Estacion,tmin),tmin))+geom_boxplot()+labs(x="Numero de estación", y="temperatura mínima")

# ordenar los boxplots no me ayuda a nada.


```
En el boxplot observamos que tenemos outliers en varias estaciones, pero como lo que nos interesa es estudiar las temperaturas mínimas sólo miraremos a las estaciones 7,13,
14, la cual presenta outliers en los mínimos.



Vemos para las estaciones 7, 13, 14 los valores de los autliers y en que fecha se dan:



```{r,warning=FALSE, echo=FALSE}

temperaturas <- read.csv("temperaturas.csv", sep = "\t")
temperaturas <- mutate(temperaturas, fecha=paste(dia,mes,anio, sep="-"))
temperaturas <- mutate(temperaturas,fecha=dmy(fecha))

temperaturas <- mutate(temperaturas, Estacion = as.factor(temperaturas$nroEstacion)) %>% filter(mes %in% c(6,7,8) )


```






Hay outliers? Grafico de bxplot por trimestre (para meses de invierno)

Tabla de temperaturas mínimas por departamento: para ver si las mínimas se registraron en el mismo año y si hay una correlación de temperaturas y ubicación geografica( sur-centro-norte). Se agrega una variable mas

detallar que departamentos son parte de cada grupo.

hay correlacion entre las temperaturas mínimas y la altitud?


Plot de temperatura mínima registrada en cada año, (puede ser un plotly) coloreado por zona de estación. La idea es explorar si los mínimos siempre se dan en la misma zona o no. si hay una correlación.


Exploración espacial:

Se presentan dos mapas, uno en el cual se ubican las estaciones seleccionadas y otro que muestra las temperaturas mínimas por mes en cada departamento coloreado por las temperaturas.



##Metodologia: Métodos para elegir los datos con los cuales se aplicará la teoría de extremos

#Metodo del Umbral:


#Método de block máxima:





##Descripción de la aplicación shiny

A través de la aplicación Shiny, mostraremos el análisis exploratorio de los datos, aparecerán gráficos de la serie de temperaturas, pudiendo filtrar por numero de estación, y pudiendo ubicar geograficamente las mismas. Para todo el territorio uruguayo se podrá observar por mes las temperaturas mínimas registradas en cada departamento.









##Comentarios finales




## Referencias

-coles
-R
-librerias
